Part 1: Overview - What Are We Building?
This guide walks you through building an Attrition Dashboard in Power BI. By the end, you'll have a dashboard that shows:
â€¢	How many employees left (and why)
â€¢	Attrition rates by organization, job series, and time period
â€¢	New hire retention
â€¢	Trends over time
What You Need
1.	Power BI Desktop (free download from Microsoft)
2.	Access to your SharePoint site with employee data files
3.	The OrgMAPPING.xlsx file
Key Terms Explained
Term	What It Means
Attrition Rate	Percentage of employees who left during a time period
Retention Rate	Percentage of employees who stayed
NOA Code	Nature of Action - codes that describe why someone left (300s = external, 501/570/702/721 = internal)
Power Query / M Code	Code that loads and transforms your data (runs when you refresh)
DAX Measures	Formulas that calculate values for your visuals (like Excel formulas)
Snapshot Date	The date when employee data was captured
â€ƒ
Part 2: Power Query Setup (M Code)
Power Query is where we load and prepare the data. Follow these steps exactly in order.
Step 1: Open Power Query Editor
In Power BI Desktop:
4.	Click "Transform data" button in the Home ribbon
5.	This opens the Power Query Editor window
Step 2: Create Parameters
Parameters let you change settings without editing code. Go to: Home â†’ Manage Parameters â†’ New Parameter
Create these 7 parameters:
Name	Type	Current Value
SharePointSiteURL	Text	https://dod365.sharepoint-mil.us/teams/DISA-AttritionRetentionAutomation/
FolderPath	Text	/Attrition-Retention Automation/TEST/NewTest/
OrgMappingFileName	Text	OrgMAPPING.xlsx
EmpDataFilePrefix	Text	DISA Empl
ActionsFileKeyword	Text	Actions
RangeStart	Date/Time	1/1/2020 12:00:00 AM
RangeEnd	Date/Time	12/31/2030 12:00:00 AM
NewHireThresholdDays	Number	730 (equals 2 years)
ðŸ’¡ TIP: The RangeStart and RangeEnd parameters are used for incremental refresh - they filter data to only load what's needed.
Step 3: Create Helper Functions
Functions are reusable code blocks. Right-click in the Queries pane â†’ New Query â†’ Blank Query â†’ then paste the code in the Advanced Editor.
Function 1: fnGetOrgCode
Extracts the first 2 characters from an organization code (handles dashes and nulls):
let     fnGetOrgCode = (inputText as nullable text, optional numChars as number) as nullable text =>     let         chars = if numChars = null then 2 else numChars,         cleaned = if inputText = null then null                   else                        let                           trimmed = Text.Trim(inputText),                           afterDash = Text.AfterDelimiter(trimmed, "-"),                           baseText = if afterDash = "" or afterDash = null then trimmed else afterDash                       in                           baseText,         result = if cleaned = null then null                  else if Text.Length(cleaned) < chars then cleaned                  else Text.Start(cleaned, chars)     in         result in     fnGetOrgCode
Function 2: fnParseSnapshotDate
Extracts the date from file names like 'DISA Empl Data 15 Jan 24.xlsx':
let     fnParseSnapshotDate = (fileName as text) as nullable date =>     let         baseName = Text.BeforeDelimiter(fileName, ".xlsx"),         baseName2 = Text.BeforeDelimiter(if baseName = "" then fileName else baseName, ".xls"),         cleanName = if baseName2 = "" then baseName else baseName2,         datePartRaw = Text.Trim(             if Text.Contains(cleanName, "Data ") then Text.AfterDelimiter(cleanName, "Data ")             else if Text.Contains(cleanName, "DATA ") then Text.AfterDelimiter(cleanName, "DATA ")             else cleanName         ),         result =              try Date.FromText(datePartRaw, [Culture="en-US"]) otherwise             try                  let                     parts = Text.Split(datePartRaw, " "),                     day = Number.From(parts{0}),                     monthText = parts{1},                     yearText = parts{2},                     month = Date.Month(Date.FromText("1 " & monthText & " 2000")),                     year = if Number.From(yearText) < 100 then 2000 + Number.From(yearText) else Number.From(yearText)                 in                     #date(year, month, day)             otherwise null     in         result in     fnParseSnapshotDate
Function 3: fnIsStudentIntern
Checks if an employee is a student/intern (to exclude from attrition counts):
let     fnIsStudentIntern = (title as nullable text, series as nullable text, pcn as nullable text) as logical =>     let         titleLower = Text.Lower(title ?? ""),         seriesText = series ?? "",         pcnUpper = Text.Upper(pcn ?? ""),         isStudent = Text.Contains(titleLower, "student") or                     Text.Contains(titleLower, "intern") or                     Text.EndsWith(seriesText, "99"),         isException = Text.Contains(pcnUpper, "RG") or Text.Contains(pcnUpper, "VT"),         result = isStudent and not isException     in         result in     fnIsStudentIntern
Function 4: fnClassifyNOA
Classifies NOA codes into movement types and voluntary/non-voluntary:
let     fnClassifyNOA = (noaCode as nullable text) as record =>     let         noa = Text.Upper(Text.Trim(noaCode ?? "")),         isExternal = Text.StartsWith(noa, "3") or noa = "T352" or noa = "CAO",         isInternal = List.Contains({"501", "570", "702", "721"}, noa),         isNonVoluntary = List.Contains({"330", "355", "357", "385"}, noa),         isValidLoss = isExternal or isInternal,         movementType = if isExternal then "External"                        else if isInternal then "Internal"                        else "Other",         voluntaryType = if isNonVoluntary then "Non-voluntary" else "Voluntary",         attritionType = if isNonVoluntary then "Non-voluntary"                         else if isValidLoss then "Voluntary"                         else "Not Applicable"     in         [             IsExternal = isExternal,             IsInternal = isInternal,             IsNonVoluntary = isNonVoluntary,             IsValidLoss = isValidLoss,             IsAttritionNOA = isExternal,             MovementType = movementType,             VoluntaryType = voluntaryType,             AttritionType = attritionType         ] in     fnClassifyNOA
â€ƒ
Step 4: Create Dim_Organization Query
This loads the organization mapping table. Create a new blank query and paste:
let     FullURL = Text.Combine({         Text.TrimEnd(SharePointSiteURL, "/"),         "/Shared%20Documents",         Text.Replace(FolderPath, "/", "%2F"),         OrgMappingFileName     }),     Source = try Excel.Workbook(Web.Contents(FullURL), null, true)               otherwise error "Could not connect to " & FullURL,     MappingSheet = try Source{[Item="Mapping", Kind="Sheet"]}[Data]                    otherwise try Source{[Item="mapping", Kind="Sheet"]}[Data]                    otherwise try Source{[Item="Sheet1", Kind="Sheet"]}[Data]                    otherwise error "Could not find Mapping sheet",     #"Promoted Headers" = Table.PromoteHeaders(MappingSheet, [PromoteAllScalars=true]),     #"Changed Type" = Table.TransformColumnTypes(#"Promoted Headers", {         {"Dcode", type text},         {"Center", type text},         {"Org", type text},         {"CAM ID", type text}     }, "en-US"),     #"Filtered Rows" = Table.SelectRows(#"Changed Type", each [Dcode] <> null and [Dcode] <> ""),     #"Buffered" = Table.Buffer(#"Filtered Rows") in     #"Buffered"
Step 5: Create Emp Data Query
This loads all employee snapshot files. Create a new blank query and paste:
let     Source = SharePoint.Files(SharePointSiteURL, [ApiVersion=15]),     #"Filtered Folder" = Table.SelectRows(Source, each          Text.Contains([Folder Path], FolderPath) and         [Attributes]?[Hidden]? <> true     ),     #"Filtered Files" = Table.SelectRows(#"Filtered Folder", each          Text.StartsWith([Name], EmpDataFilePrefix) and          (Text.EndsWith([Name], ".xlsx") or Text.EndsWith([Name], ".xls"))     ),     #"Added Snapshot Date" = Table.AddColumn(#"Filtered Files", "Snapshot Date",          each fnParseSnapshotDate([Name]), type date),     #"Valid Dates" = Table.SelectRows(#"Added Snapshot Date", each [Snapshot Date] <> null),     #"Added Data" = Table.AddColumn(#"Valid Dates", "FileData", each          let             currentDate = [Snapshot Date],             content = try                 let                     wb = Excel.Workbook([Content], null, true),                     data = try wb{[Item="Table1", Kind="Table"]}[Data]                            otherwise try wb{[Item="Sheet1", Kind="Sheet"]}[Data]                            otherwise null,                     withDate = if data <> null then                                 Table.AddColumn(data, "Snapshot Date", each currentDate, type date)                                else null                 in                     withDate             otherwise null         in             content     ),     #"Valid Data" = Table.SelectRows(#"Added Data", each [FileData] <> null),     #"Combined" = Table.Combine(#"Valid Data"[FileData]),     #"Typed" = Table.TransformColumnTypes(#"Combined", {         {"DoD ID (EDIPI)", type text},         {"Org Structure ID", type text},         {"Occ Series Current", type text},         {"Title", type text},         {"Manpower PCN", type text},         {"Dt Arrived Personnel Office", type date},         {"Snapshot Date", type date}     }, "en-US"),     #"Added Org Key" = Table.AddColumn(#"Typed", "ORG First 2",          each fnGetOrgCode([#"Org Structure ID"], 2), type text),     #"Joined Org" = Table.NestedJoin(#"Added Org Key", {"ORG First 2"},          Dim_Organization, {"Dcode"}, "OrgMatch", JoinKind.LeftOuter),     #"Expanded Org" = Table.ExpandTableColumn(#"Joined Org", "OrgMatch",          {"Center", "Org"}, {"Center", "Org"}),     #"Added StudentIntern" = Table.AddColumn(#"Expanded Org", "IsStudentIntern",         each fnIsStudentIntern([Title], [#"Occ Series Current"], [#"Manpower PCN"]), type logical),     #"Added NewHire" = Table.AddColumn(#"Added StudentIntern", "Is New Hire", each         if [Dt Arrived Personnel Office] <> null and [Snapshot Date] <> null          then Duration.Days([Snapshot Date] - [Dt Arrived Personnel Office]) <= NewHireThresholdDays          else false, type logical) in     #"Added NewHire"
â€ƒ
Step 6: Create Personnel Actions Query
This loads departure/movement records. Create a new blank query and paste:
let     Source = SharePoint.Files(SharePointSiteURL, [ApiVersion=15]),     #"Filtered Folder" = Table.SelectRows(Source, each          Text.Contains([Folder Path], FolderPath) and         [Attributes]?[Hidden]? <> true     ),     #"Filtered Files" = Table.SelectRows(#"Filtered Folder", each          Text.Contains([Name], ActionsFileKeyword) and          (Text.EndsWith([Name], ".xlsx") or Text.EndsWith([Name], ".xls"))     ),     #"Added Data" = Table.AddColumn(#"Filtered Files", "FileData", each          try Excel.Workbook([Content], null, true){[Item="Table1", Kind="Table"]}[Data]         otherwise null     ),     #"Valid Data" = Table.SelectRows(#"Added Data", each [FileData] <> null),     #"Combined" = Table.Combine(#"Valid Data"[FileData]),     #"Date Filtered" = Table.SelectRows(#"Combined", each          [EFFECTIVE_DATE_4] >= RangeStart and [EFFECTIVE_DATE_4] < RangeEnd     ),     #"Deduplicated" = Table.Distinct(#"Date Filtered",          {"NAME_PERS_1", "FIRST_NOA_CODE_5A", "EFFECTIVE_DATE_4"}),     #"Typed" = Table.TransformColumnTypes(#"Deduplicated", {         {"EFFECTIVE_DATE_4", type date},         {"DT_ARR_SVCG_CCPO", type date},         {"FIRST_NOA_CODE_5A", type text},         {"FIRST_NOA_DESC_5B", type text},         {"FROM_POSITION_ORG_LINE6_14", type text},         {"TO_POSITION_ORG_LINE6_22", type text}     }, "en-US"),     #"Added From Org Code" = Table.AddColumn(#"Typed", "From ORG 2 Digit",         each fnGetOrgCode([FROM_POSITION_ORG_LINE6_14], 2), type text),     #"Added To Org Code" = Table.AddColumn(#"Added From Org Code", "To ORG 2 Digit",         each fnGetOrgCode([TO_POSITION_ORG_LINE6_22], 2), type text),     #"Joined From" = Table.NestedJoin(#"Added To Org Code", {"From ORG 2 Digit"},         Dim_Organization, {"Dcode"}, "FromMatch", JoinKind.LeftOuter),     #"Expanded From" = Table.ExpandTableColumn(#"Joined From", "FromMatch",         {"Org"}, {"From Org"}),     #"Joined To" = Table.NestedJoin(#"Expanded From", {"To ORG 2 Digit"},         Dim_Organization, {"Dcode"}, "ToMatch", JoinKind.LeftOuter),     #"Expanded To" = Table.ExpandTableColumn(#"Joined To", "ToMatch",         {"Org"}, {"To Org"}),     #"Added NOA Class" = Table.AddColumn(#"Expanded To", "NOA_Classification",         each fnClassifyNOA([FIRST_NOA_CODE_5A]), type record),     #"Expanded NOA" = Table.ExpandRecordColumn(#"Added NOA Class", "NOA_Classification",         {"IsValidLoss", "IsAttritionNOA", "MovementType", "VoluntaryType"},         {"Is Valid Loss", "Is Attrition NOA", "Internal External Movement", "Voluntary Type"}),     #"Added StudentIntern" = Table.AddColumn(#"Expanded NOA", "IsStudentIntern",         each fnIsStudentIntern([MOST_RECENT_EMPL_POSN_TITLE], [FROM_OCC_CODE_9], [MOST_RECENT_EMPL_MANPOWER_PCN]),         type logical),     #"Added NewHire" = Table.AddColumn(#"Added StudentIntern", "Is New Hire", each         if [DT_ARR_SVCG_CCPO] <> null and [EFFECTIVE_DATE_4] <> null         then Duration.Days([EFFECTIVE_DATE_4] - [DT_ARR_SVCG_CCPO]) <= NewHireThresholdDays         else false, type logical),     #"Added Compare Org" = Table.AddColumn(#"Added NewHire", "Compare From and To Org", each         if [Is Attrition NOA] then false         else if [From Org] = null or [To Org] = null then false         else [From Org] = [To Org], type logical) in     #"Added Compare Org"
Step 7: Close and Apply
Click 'Close & Apply' in the Home ribbon to load the data into Power BI.
â€ƒ
Part 3: DAX Measures
DAX measures are formulas that calculate values for your visuals. Create them in the order shown below.
Step 1: Create Slicer Tables
These tables power the date slicers. Go to: Modeling â†’ New Table
Start Period table:
Start Period =  DISTINCT(     SELECTCOLUMNS(         'Emp Data',         "Period", 'Emp Data'[Snapshot Date]     ) )
End Period table:
End Period =  DISTINCT(     SELECTCOLUMNS(         'Emp Data',         "Period", 'Emp Data'[Snapshot Date]     ) )
Movement Type table:
Movement Type =  DATATABLE(     "Movement", STRING,     {         {"External"},         {"Internal"},         {"All"}     } )
Voluntary Type table:
Voluntary Type =  DATATABLE(     "Type", STRING,     {         {"Voluntary"},         {"Non-voluntary"},         {"All"}     } )
Step 2: Create Base Measures
These are foundation measures. Go to: Modeling â†’ New Measure
_StartDate:
_StartDate =  COALESCE(     SELECTEDVALUE('Start Period'[Period]),     MIN('Emp Data'[Snapshot Date]) )
_EndDate:
_EndDate =  COALESCE(     SELECTEDVALUE('End Period'[Period]),     MAX('Emp Data'[Snapshot Date]) )
_HasValidDates:
_HasValidDates =  NOT(ISBLANK([_StartDate])) && NOT(ISBLANK([_EndDate])) && [_StartDate] <= [_EndDate]
Step 3: Create Core Headcount Measures
On-Hand Start:
On-Hand Start =  IF(     NOT([_HasValidDates]),     BLANK(),     CALCULATE(         DISTINCTCOUNT('Emp Data'[DoD ID (EDIPI)]),         'Emp Data'[Snapshot Date] = [_StartDate],         'Emp Data'[IsStudentIntern] = FALSE     ) )
On-Hand End:
On-Hand End =  IF(     NOT([_HasValidDates]),     BLANK(),     CALCULATE(         DISTINCTCOUNT('Emp Data'[DoD ID (EDIPI)]),         'Emp Data'[Snapshot Date] = [_EndDate],         'Emp Data'[IsStudentIntern] = FALSE     ) )
Avg On-Hand:
Avg On-Hand =  DIVIDE([On-Hand Start] + [On-Hand End], 2)
â€ƒ
Step 4: Create Loss Measures
_BaseLosses (internal measure):
_BaseLosses =  IF(     NOT([_HasValidDates]),     BLANK(),     CALCULATE(         COUNTROWS('Personnel Actions'),         'Personnel Actions'[Is Valid Loss] = TRUE,         'Personnel Actions'[Compare From and To Org] = FALSE,         'Personnel Actions'[EFFECTIVE_DATE_4] >= [_StartDate],         'Personnel Actions'[EFFECTIVE_DATE_4] <= [_EndDate],         'Personnel Actions'[IsStudentIntern] = FALSE     ) )
Total Losses:
Total Losses =  VAR MovementFilter = SELECTEDVALUE('Movement Type'[Movement], "All") VAR VoluntaryFilter = SELECTEDVALUE('Voluntary Type'[Type], "All") RETURN CALCULATE(     [_BaseLosses],     IF(MovementFilter = "All",          ALL('Personnel Actions'[Internal External Movement]),         'Personnel Actions'[Internal External Movement] = MovementFilter     ),     IF(VoluntaryFilter = "All",         ALL('Personnel Actions'[Voluntary Type]),         'Personnel Actions'[Voluntary Type] = VoluntaryFilter     ) )
External Losses:
External Losses =  CALCULATE([_BaseLosses], 'Personnel Actions'[Internal External Movement] = "External")
Internal Losses:
Internal Losses =  CALCULATE([_BaseLosses], 'Personnel Actions'[Internal External Movement] = "Internal")
Step 5: Create Rate Measures
Attrition Rate:
Attrition Rate =  VAR Losses = [Total Losses] VAR AvgHC = [Avg On-Hand] RETURN IF(     ISBLANK(Losses) || ISBLANK(AvgHC) || AvgHC = 0,     BLANK(),     DIVIDE(Losses, AvgHC) * 100 )
Retention Rate:
Retention Rate =  DIVIDE([On-Hand End], [On-Hand Start]) * 100
Step 6: Create New Hire Measures
New Hires:
New Hires =  IF(     NOT([_HasValidDates]),     BLANK(),     CALCULATE(         DISTINCTCOUNT('Emp Data'[DoD ID (EDIPI)]),         'Emp Data'[Snapshot Date] = [_EndDate],         'Emp Data'[Is New Hire] = TRUE,         'Emp Data'[IsStudentIntern] = FALSE     ) )
New Hire Losses:
New Hire Losses =  IF(     NOT([_HasValidDates]),     BLANK(),     CALCULATE(         COUNTROWS('Personnel Actions'),         'Personnel Actions'[Is Valid Loss] = TRUE,         'Personnel Actions'[Compare From and To Org] = FALSE,         'Personnel Actions'[EFFECTIVE_DATE_4] >= [_StartDate],         'Personnel Actions'[EFFECTIVE_DATE_4] <= [_EndDate],         'Personnel Actions'[Is New Hire] = TRUE,         'Personnel Actions'[IsStudentIntern] = FALSE     ) )
New Hire Attrition Rate:
New Hire Attrition Rate =  VAR Losses = [New Hire Losses] VAR Current = [New Hires] VAR Pool = Losses + Current RETURN IF(Pool = 0, BLANK(), DIVIDE(Losses, Pool) * 100)
â€ƒ
Part 4: Building the Dashboard
Step 1: Add Slicers
Drag these fields to create slicers:
â€¢	Start Period[Period] â†’ Dropdown slicer
â€¢	End Period[Period] â†’ Dropdown slicer
â€¢	Dim_Organization[Org] â†’ Dropdown with 'Select All'
â€¢	Movement Type[Movement] â†’ Tile/Button slicer
â€¢	Voluntary Type[Type] â†’ Tile/Button slicer
Step 2: Add KPI Cards
Use Card visuals for these measures:
Card Title	Measure to Use
On-Hand (Start)	[On-Hand Start]
On-Hand (End)	[On-Hand End]
Total Losses	[Total Losses]
Attrition Rate	[Attrition Rate] (format as %)
Retention Rate	[Retention Rate] (format as %)
Step 3: Add Charts
Chart 1: Losses by Organization
â€¢	Visual type: Stacked Bar Chart
â€¢	Y-Axis: Dim_Organization[Org]
â€¢	X-Axis: [Total Losses]
Chart 2: New Hire Donut
â€¢	Visual type: Donut Chart
â€¢	Values: [New Hire Losses], [New Hires]
Chart 3: Losses by Job Series
â€¢	Visual type: Stacked Bar Chart
â€¢	Y-Axis: 'Emp Data'[Occ Series Current]
â€¢	X-Axis: [Total Losses]
â€¢	Filter: Top 10 by [Total Losses]
â€ƒ
Part 5: Incremental Refresh
Incremental refresh makes your report load faster by only refreshing recent data.
Step 1: Requirements
â€¢	Parameters named exactly 'RangeStart' and 'RangeEnd' (already created)
â€¢	Your query must filter on these parameters (already done in Personnel Actions)
â€¢	Power BI Pro or Premium license for service refresh
Step 2: Configure
6.	Right-click on 'Personnel Actions' table in the Fields pane
7.	Select 'Incremental refresh'
8.	Toggle 'Incrementally refresh this table' to ON
9.	Set 'Archive data starting' to 2 Years
10.	Set 'Incrementally refresh starting' to 3 Months
11.	Enable 'Detect data changes' with EFFECTIVE_DATE_4 column
ðŸ’¡ TIP: After configuring, publish to Power BI Service and set up a scheduled refresh (e.g., daily at 6:00 AM).
â€ƒ
Part 6: Quick Reference
NOA Code Reference
Category	NOA Codes	Meaning
External	300s, T352, CAO	Left the agency
Internal	501, 570, 702, 721	Moved within DISA
Non-Voluntary	330, 355, 357, 385	Removals/terminations
Attrition Formula
Attrition Rate = (Total Losses / Average On-Hand) Ã— 100
Where:
â€¢	Total Losses = Count of departures during the period
â€¢	Average On-Hand = (Start Count + End Count) / 2
Query Load Order
Always load queries in this order to avoid errors:
12.	Parameters (all 7)
13.	Functions (fn*)
14.	Dim_Organization
15.	Emp Data
16.	Personnel Actions
Troubleshooting
'Query references a non-existent query'
â†’ Check that Dim_Organization exists and loads before other queries.
'Cannot connect to SharePoint'
â†’ Verify your SharePointSiteURL parameter is correct and you have access.
'No data showing in visuals'
â†’ Check your date slicers - make sure Start Period is before End Period.
'Measures show blank'
â†’ Ensure _HasValidDates returns TRUE (check slicer selections).
Adding New Data Files
17.	Save new files to the SharePoint folder with correct naming (e.g., 'DISA Empl Data 15 Jan 25.xlsx')
18.	Click Refresh in Power BI
19.	New periods will automatically appear in the date slicers

ðŸ’¡ TIP: Need help? Check the full documentation files (DISA_M_Code_Scalable.txt and DISA_DAX_Scalable.txt) for complete code references.

