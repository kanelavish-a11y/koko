/// Occupational series classification codes (OPM job series).
table Dim_Series
	lineageTag: 8cfa9bf2-3bae-407e-be99-6cc614f66ddb

	column 'Occ Series Current'
		dataType: string
		lineageTag: fac1892c-fdf1-411d-b1ae-1e45fcadef39
		summarizeBy: none
		sourceColumn: Occ Series Current

		annotation SummarizationSetBy = Automatic

	partition Dim_Seires = m
		mode: import
		source =
				let
				    Source = SharePoint.Files("https://dod365.sharepoint-mil.us/teams/DISA-AttritionRetentionAutomation/", [ApiVersion=15]),
				    #"Filter Folder" = Table.SelectRows(Source, each Text.EndsWith([Folder Path], "https://dod365.sharepoint-mil.us/teams/DISA-AttritionRetentionAutomation/Shared Documents/Attrition-Retention Automation/TEST/NewTest/")),
				    #"Filter Name" = Table.SelectRows(#"Filter Folder", each Text.StartsWith([Name], "DISA Empl")),
				    #"Filter Hidden" = Table.SelectRows(#"Filter Name", each [Attributes]?[Hidden]? <> true),
				    AddSnapshotDate = Table.AddColumn(#"Filter Hidden", "Snapshot Date", each let base = Text.BeforeDelimiter([Name], ".xlsx"), parts = Text.Split(base, " "), count = List.Count(parts), dayText = parts{count-3}, monthText = parts{count-2}, yearText = parts{count-1}, dayNum = try Number.From(dayText) otherwise 1, yearNum = Number.From("20" & yearText), monthNum = Date.Month(Date.FromText("1 " & monthText & " 2000")) in #date(yearNum, monthNum, dayNum), type date),
				    AddData = Table.AddColumn(AddSnapshotDate, "Data", each let currentSnapshotDate = [Snapshot Date], FileContent = try let sourceTable = Excel.Workbook([Content], null, true){[Item="Table1", Kind="Table"]}[Data], withDate = Table.AddColumn(sourceTable, "Snapshot Date", each currentSnapshotDate, type date) in withDate otherwise null in FileContent),
				    #"Keep With Data" = Table.SelectRows(AddData, each [Data] <> null),
				    CombinedData = Table.Combine(#"Keep With Data"[Data]),
				    #"Changed Type" = Table.TransformColumnTypes(CombinedData,{{"DoD ID (EDIPI)", type text}, {"Org Structure ID", type text}, {"Occ Series Current", type text}, {"Title", type text}, {"Manpower PCN", type text}, {"Dt Arrived Personnel Office", type date}, {"Dt of Birth", type date}}),
				    AddOrgPrefix = Table.AddColumn(#"Changed Type", "ORG First 2", each try Text.Start(Text.Trim([#"Org Structure ID"]), 2) otherwise null, type text),
				    JoinOrg = Table.NestedJoin(AddOrgPrefix, {"ORG First 2"}, Dim_Organization, {"Dcode"}, "OrgMap", JoinKind.LeftOuter),
				    ExpandOrg = Table.ExpandTableColumn(JoinOrg, "OrgMap", {"Center", "Org"}, {"Center", "Org"}),
				    AddStudentInternFlag = Table.AddColumn(ExpandOrg, "IsStudentIntern", each let title = Text.Lower(Text.From(try [Title] otherwise "")), series = Text.From(try [#"Occ Series Current"] otherwise ""), pcn = Text.Upper(Text.From(try [#"Manpower PCN"] otherwise "")) in ((Text.Contains(title, "student") or Text.EndsWith(series, "99")) and not (Text.Contains(pcn, "RG") or Text.Contains(pcn, "VT"))), type logical),
				    #"Added Composite Key" = Table.AddColumn(
				    AddStudentInternFlag,
				    "CompositeKey",
				    each Text.Upper(Text.Select([#"Manpower PCN"], {"A".."Z", "a".."z", "0".."9"})) & "-" & Text.Upper(Text.Select([#"NAME-FULL"], {"A".."Z", "a".."z"}))
				)
				
				
				in
				    #"Added Composite Key"
				```

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Table

