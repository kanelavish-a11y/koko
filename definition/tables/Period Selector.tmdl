table 'Period Selector'

	/// Period aggregation options for different time views (QTD, YTD, Rolling, etc.)
	calculationGroup
		precedence: 20

		/// Quarter to date - from start of quarter to selected date
		calculationItem QTD =
				VAR CurrentDate = MAX('SnapshotDate_End'[Snapshot Date])
				VAR QuarterStart = DATE(YEAR(CurrentDate), (QUARTER(CurrentDate) - 1) * 3 + 1, 1)
				RETURN
				    CALCULATE(
				        SELECTEDMEASURE(),
				        'SnapshotDate_End'[Snapshot Date] >= QuarterStart,
				        'SnapshotDate_End'[Snapshot Date] <= CurrentDate
				    )

		/// Year to date - from start of year to selected date
		calculationItem YTD =
				VAR CurrentDate = MAX('SnapshotDate_End'[Snapshot Date])
				VAR YearStart = DATE(YEAR(CurrentDate), 1, 1)
				RETURN
				    CALCULATE(
				        SELECTEDMEASURE(),
				        'SnapshotDate_End'[Snapshot Date] >= YearStart,
				        'SnapshotDate_End'[Snapshot Date] <= CurrentDate
				    )

		/// Rolling 4 quarters average
		calculationItem 'Rolling 4Q Avg' =
				VAR CurrentDate = MAX('SnapshotDate_End'[Snapshot Date])
				VAR StartDate = EDATE(CurrentDate, -12)
				RETURN
				    CALCULATE(
				        SELECTEDMEASURE(),
				        'SnapshotDate_End'[Snapshot Date] > StartDate,
				        'SnapshotDate_End'[Snapshot Date] <= CurrentDate,
				        ALL('SnapshotDate_End')
				    ) / 4

		/// Same quarter last year comparison
		calculationItem 'Same Quarter LY' =
				VAR CurrentDate = MAX('SnapshotDate_End'[Snapshot Date])
				VAR PriorYearDate = EDATE(CurrentDate, -12)
				RETURN
				    CALCULATE(
				        SELECTEDMEASURE(),
				        'SnapshotDate_End'[Snapshot Date] = PriorYearDate
				    )

		/// Cumulative total over all time
		calculationItem 'All Time' =
				CALCULATE(
				    SELECTEDMEASURE(),
				    ALL('SnapshotDate_End'),
				    ALL('SnapshotDate_Start')
				)

	column 'Period Selector'
		dataType: string

	partition 'Partition_Period Selector' = calculationGroup

